# -*- coding:utf-8 -*-
# author: zby
# email: by951118@163.com
# date: 2021/7/28

import re
import random
import time
import requests
import json
from lxml import etree
from requests_html import HTMLSession
from urllib.parse import urljoin

from PyQt5.QtWidgets import *
import sys


class schema_test:
    headers ={"Content-Type": "application/vnd.kafka.avro.v2+json","Accept": "application/vnd.kafka.v2+json"}
    schema_url = "http://10.20.18.6:8082/topics/user_behavior_tmp2"
    key_schema = '{"name":"_id" ,"type": "string"}'
    item = {'id': '110728fdf75e198fe131c3b620d8a56f95', '_ch': 11, '_key': '0728fdf75e198fe131c3b620d8a56f95', '_spec': 'M-APP06-AI', '_dcm': '监控采集', '_adp': '中科天玑', 'lang': {'string': 'zh'}, 'title': None, 'content': None, 'abstract': None, 'content_raw': None, 'title_CN': None, 'content_CN': None, 'abstract_CN': None, 'tags': None, 'source': None, 'update_time': 1635503193000, 'gather_time': 1635503193000, 'insert_time': 1635503193000, 'publish_time': 1635503193000, 'cover_image_urls': None, 'picture_urls': None, 'audio_urls': None, 'video_urls': None, 'file_urls': None, 'picture_paths': None, 'audio_paths': None, 'video_paths': None, 'file_paths': None, 'picture_contents': None, 'audio_contents': None, 'video_contents': None, 'media_id': {'string': '91'}, 'media_name': '东方财富APP', 'media_url': None, 'media_location': None, 'board_id': None, 'board_name': None, 'board_url': None, 'board_name_full': None, 'url': None, 'reposts_count': {'int': 0}, 'likes_count': {'int': 0}, 'dislikes_count': {'int': 0}, 'views_count': {'int': 0}, 'comments_count': {'int': 226}, 'attitudes_count': {'int': 0}, 'favourites_count': None, 'quoted_count': None, 'viewing_count': None, 'play_count': None, 'share_count': {'int': 0}, 'danmaku_count': None, 'keywords': None, 'keywords_vector': None, 'persons_vector': None, 'organizations_vector': None, 'regions_vector': None, 'message_type': 1, 'mention_list': None, 'topic_list': None, 'post_location': None, 'post_location_geo': None, 'root_id': None, 'parent_id': None, 'retweeted_status': None, 'quoted_status': None, 'sentiment': 0, 'similar_id': None, 'is_public': 1, 'author_id': None, 'author_name': None, 'author_screen_name': None, 'author_full_info': None, 'group_id': None, 'group_name': None, 'extra_info': None}
    body = [{'key': item['_key'], 'value': item}]
    value_schema = '{"type": "record","name": "golaxy_data_dict_v3","fields": [{"name": "_ch","type": "int"},{"name": "id","type": "string"},{"name": "_key","type": "string"},{"name": "_spec","type": "string"},{"name": "_dcm","type": "string"},{"name": "_adp","type": "string"},{"name": "lang","type": ["string","null"]},{"name": "title","type": ["string","null"]},{"name": "content","type": ["string","null"]},{"name": "abstract","type": ["string","null"]},{"name": "content_raw","type": ["string","null"]},{"name": "title_CN","type": ["string","null"]},{"name": "content_CN","type": ["string","null"]},{"name": "abstract_CN","type": ["string","null"]},{"name": "tags","type": [{"type": "array","items": "string"},"null"]},{"name": "source","type": ["string","null"]},{"name": "publish_time","type": "long"},{"name": "update_time","type": "long"},{"name": "gather_time","type": "long"},{"name": "insert_time","type": "long"},{"name": "picture_urls","type": [{"type": "array","items": "string"},"null"]},{"name": "audio_urls","type": [{"type": "array","items": "string"},"null"]},{"name": "video_urls","type": [{"type": "array","items": "string"},"null"]},{"name": "file_urls","type": [{"type": "array","items": "string"},"null"]},{"name": "picture_paths","type": [{"type": "array","items": "string"},"null"]},{"name": "audio_paths","type": [{"type": "array","items": "string"},"null"]},{"name": "video_paths","type": [{"type": "array","items": "string"},"null"]},{"name": "file_paths","type": [{"type": "array","items": "string"},"null"]},{"name": "picture_contents","type": [{"type": "array","items": "string"},"null"]},{"name": "audio_contents","type": [{"type": "array","items": "string"},"null"]},{"name": "video_contents","type": [{"type": "array","items": "string"},"null"]},{"name": "media_id","type": ["string","null"]},{"name": "media_name","type": "string"},{"name": "media_url","type": ["string","null"]},{"name": "media_location","type": [{"type": "array","items": "string"},"null"]},{"name": "board_id","type": ["string","null"]},{"name": "board_name","type": ["string","null"]},{"name": "board_url","type": ["string","null"]},{"name": "board_name_full","type": [{"type": "array","items": "string"},"null"]},{"name": "url","type": ["string","null"]},{"name": "reposts_count","type": ["int","null"]},{"name": "viewing_count","type": ["int","null"]},{"name": "quoted_count","type": ["int","null"]},{"name": "favourites_count","type": ["int","null"]},{"name": "attitudes_count","type": ["int","null"]},{"name": "comments_count","type": ["int","null"]},{"name": "views_count","type": ["int","null"]},{"name": "dislikes_count","type": ["int","null"]},{"name": "likes_count","type": ["int","null"]},{"name": "danmaku_count","type": ["int","null"]},{"name": "share_count","type": ["int","null"]},{"name": "play_count","type": ["int","null"]},{"name": "keywords_vector","type": [{"type": "array","items": {"type": "record","name": "keywords_vector","fields": [{"name": "v","type": "string"},{"name": "w","type": "int"}]}},"null"]},{"name": "organizations_vector","type": [{"type": "array","items": {"type": "record","name": "organizations_vector","fields": [{"name": "v","type": "string"},{"name": "w","type": "int"}]}},"null"]},{"name": "persons_vector","type": [{"type": "array","items": {"type": "record","name": "persons_vector","fields": [{"name": "v","type": "string"},{"name": "w","type": "int"}]}},"null"]},{"name": "regions_vector","type": [{"type": "array","items": {"type": "record","name": "regions_vector","fields": [{"name": "v","type": "string"},{"name": "w","type": "int"}]}},"null"]},{"name": "message_type","type": "int"},{"name": "mention_list","type": [{"type": "array","items": "string"},"null"]},{"name": "topic_list","type": [{"type": "array","items": "string"},"null"]},{"name": "post_location","type": [{"type": "array","items": "string"},"null"]},{"name": "post_location_geo","type": [{"type": "array","items": "double"},"null"]},{"name": "sentiment","type": "int"},{"name": "similar_id","type": ["string","null"]},{"name": "is_public","type": "int"},{"name": "author_id","type": ["string","null"]},{"name": "author_name","type": ["string","null"]},{"name": "author_screen_name","type": ["string","null"]},{"name": "extra_info","type": ["string","null"]},{"name": "author_full_info","type": [{"type": "record","name": "author_full_info","fields": [{"name": "uid","type": "string"},{"name": "name","type": ["string","null"]},{"name": "screen_name","type": ["string","null"]},{"name": "description","type": ["string","null"]},{"name": "realname","type": ["string","null"]},{"name": "emails","type": [{"type": "array","items": "string"},"null"]},{"name": "phonenumbers","type": [{"type": "array","items": "string"},"null"]},{"name": "gender","type": "int"},{"name": "birthday","type": ["string","null"]},{"name": "profile_url","type": ["string","null"]},{"name": "profile_image_url","type": ["string","null"]},{"name": "cover_image","type": ["string","null"]},{"name": "friends_count","type": ["int","null"]},{"name": "bi_followers_count","type": ["int","null"]},{"name": "favourites_count","type": ["int","null"]},{"name": "followers_count","type": ["int","null"]},{"name": "statuses_count","type": ["int","null"]},{"name": "listed_count","type": ["int","null"]},{"name": "accounts_status","type": ["int","null"]},{"name": "tags","type": [{"type": "array","items": "string"},"null"]},{"name": "verified","type": "boolean"},{"name": "verified_type","type": "int"},{"name": "verified_reason","type": ["string","null"]},{"name": "is_vip","type": "boolean"},{"name": "register_time","type": ["long","null"]},{"name": "register_location","type": ["string","null"]},{"name": "register_organization","type": ["string","null"]},{"name": "in_organizations","type": [{"type": "array","items": "string"},"null"]},{"name": "groups","type": [{"type": "record","name": "groups","fields": [{"name": "group_id","type": "string"},{"name": "group_name","type": "string"},{"name": "group_description","type": ["string","null"]},{"name": "group_owner","type": "string"},{"name": "group_members","type": "int"},{"name": "members","type": [{"type": "array","items": {"type": "record","name": "members","fields": [{"name": "id","type": "string"},{"name": "name","type": "string"}]}},"null"]},{"name": "extra_info","type": ["string","null"]}]},"null"]},{"name": "extra_info","type": ["string","null"]}]},"null"]},{"name": "keywords","type": [{"type": "array","items": "string"},"null"]},{"name": "retweeted_status","type": [{"type": "record","name": "retweeted_status","fields": [{"name": "id","type": ["string","null"]},{"name": "_key","type": ["string","null"]},{"name": "title","type": ["string","null"]},{"name": "content","type": ["string","null"]},{"name": "title_CN","type": ["string","null"]},{"name": "content_CN","type": ["string","null"]},{"name": "publish_time","type": ["long","null"]},{"name": "url","type": ["string","null"]},{"name": "picture_urls","type": [{"type": "array","items": "string"},"null"]},{"name": "author_id","type": ["string","null"]},{"name": "author_name","type": ["string","null"]}]},"null"]},{"name": "quoted_status","type": [{"type": "record","name": "quoted_status","fields": [{"name": "id","type": ["string","null"]},{"name": "_key","type": ["string","null"]},{"name": "title","type": ["string","null"]},{"name": "content","type": ["string","null"]},{"name": "title_CN","type": ["string","null"]},{"name": "content_CN","type": ["string","null"]},{"name": "publish_time","type": ["long","null"]},{"name": "url","type": ["string","null"]},{"name": "picture_urls","type": [{"type": "array","items": "string"},"null"]},{"name": "author_id","type": ["string","null"]},{"name": "author_name","type": ["string","null"]}]},"null"]},{"name": "group_name","type": ["string","null"]},{"name": "group_id","type": ["string","null"]},{"name": "parent_id","type": ["string","null"]},{"name": "root_id","type": ["string","null"]},{"name": "cover_image_urls","type": [{"type": "array","items": "string"},"null"]}]}'
    data = json.dumps({'key_schema': key_schema, 'value_schema': value_schema, 'records': body})

    @classmethod
    def schema_test(cls):
        data = json.dumps({'key_schema': cls.key_schema, 'value_schema': cls.value_schema, 'records': cls.body})
        resp  = requests.post(url=cls.schema_url,headers=cls.headers,data=data)
        return resp.text

if __name__ == '__main__':
    print(schema_test.schema_test())